---
import {
  formatDate,
  Jam,
  formatDateTimeAttr,
  getTag,
} from "../../../ts/jam.ts";

import Page from "../../../layouts/Page.astro";

import Callout from "../../../components/callout/Callout.tsx";
import { Show } from "solid-js";

const currentJam: Jam | null = {
  title: "Out of this world",
  dates: {
    from: new Date("2023-06-10T10:00:00"),
    to: new Date("2023-06-17T17:00:00"),
  },
  description:
    "Explore new planets, cross vast distances in your shiny space ship, or float around petting space whales; the possibilities are endless!",
  theme: "Space and Extraterestrial",
  requirements: [
    "Include elements of the theme",
    "Teams of 1-4 are allowed",
    "Playable through submission source"
  ],
  uri: "/",
};
---

<script>
  document.getElementById("next-jam-page")?.addEventListener("click", (event) => {
    window.location.href = event.target ? event.target.getAttribute('data-uri') : '/';
  });
</script>

<Page title="Jam | Game" jam="game">
  <main>
    <section id="next-jam">
      <Show when={currentJam}>
        <div>
            <figure>
                <img src="/images/flame-space-adventures.gif" alt="Next Jam GIF" />
                <figcaption>Illustration by <a href="https://icons8.com/illustrations/author/oZpGJx8ts63Q">Thierry Fousse</a> from <a href="https://icons8.com/illustrations">Ouch!</a></figcaption>
            </figure>
          <div class="jam-head">
            <h3 data-tag={getTag(currentJam.dates.from, currentJam.dates.to)}>
              {currentJam.title}
            </h3>
            <div class="jam-date">
              <time datetime={formatDateTimeAttr(currentJam.dates.from)}>
                <strong>From</strong>
                {formatDate(currentJam.dates.from)}
              </time>

              <time datetime={formatDateTimeAttr(currentJam.dates.to)}>
                <strong>To</strong>
                {formatDate(currentJam.dates.to)}
              </time>
            </div>
          </div>
          <p class="jam-description">
            {currentJam.description}
          </p>
          <div id="next-jam-theme"><strong>Theme:</strong> {currentJam.theme}</div>

          <div class="jam-requirements">
            {
              currentJam.requirements.map((requirement, i) => (
                <div>
                  <h5>#{i + 1}</h5>
                  <span>{requirement}</span>
                </div>
              ))
            }
          </div>
          <div class="flex justify-center">
            <button
              id="next-jam-page"
              data-uri={currentJam.uri}
              role="link"
              onclick="">Jam Page</button
            >
          </div>
          
        </div>
      </Show>
      {
        !currentJam && (
          <div class="flex justify-center align-center m-auto">
            <Callout type="warning">
              There are no active game jams right now. Use <kbd>/</kbd>
              to search for previous jams or jams in other categories.
            </Callout>
          </div>
        )
      }
    </section>
  </main>
</Page>

<style>
  main {
    padding-block: 0;
    margin-bottom: 2rem;
  }
  #next-jam {
    min-height: calc(100vh - 4rem);
    min-height: calc(100dvh - 4rem);
  }

  #next-jam img {
    display: block;
    margin-inline: auto;
  }

  #next-jam > div {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  #next-jam > div h3 {
    position: relative;
    font-size: 2.5rem;
    font-family: fantasy;
    letter-spacing: 0.3rem;
    margin-top: 0;
    width: fit-content;
    margin-inline: auto;
  }

  #next-jam > div h4 {
    font-size: 1.5rem;
    margin-block: 0;
  }

  #next-jam > div h3[data-tag="Active"]::after {
    content: attr(data-tag);
    background: rgba(0, 120, 100, 0.3);
  }

  #next-jam > div h3[data-tag="Closed"]::after {
    content: attr(data-tag);
    background: rgba(200, 120, 100, 0.3);
  }

  #next-jam > div h3[data-tag="Upcoming"]::after {
    content: attr(data-tag);
    background: rgba(100, 50, 250, 0.3);
  }

  #next-jam > div h3::after {
    font-size: 0.8rem;
    position: absolute;
    letter-spacing: normal;
    font-family: "Franklin Gothic Medium", "Arial Narrow", Arial, sans-serif;
    padding: 0.2rem 0.4rem;
    border-radius: 0.2rem;

    position: absolute;
    rotate: 40deg;
    top: -50%;
    right: -2.5rem;
  }

  .jam-description {
    text-indent: 1rem;
  }
  .jam-requirements {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .jam-requirements > div {
    background-color: white;
    display: flex;
    align-items: center;
    gap: .5rem;
    width: 40%;
    margin: 1rem;
    padding: 1rem;
    border-radius: 0.5rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  .jam-requirements > div h5 {
    font-size: 1.2rem;
    margin-block: 0;
  }
  .jam-date {
    display: flex;
    gap: 1.25rem;
  }
  .jam-head {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .jam-head h3 {
    margin-bottom: 0;
  }

  .next-jam {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  section.jam-section h3 {
    width: 100%;
    background: rgba(200, 100, 100, 0.3);
    padding: 0.5rem;
    border-radius: 0.5rem;
    margin-top: 0;
  }

  button {
    background-color: white;
    border: none;
    outline: none;
    padding: 0.75rem 1rem;
    width: fit-content;
    font-weight: bold;
    border-radius: 2rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
  }

  button:hover {
    background-color: rgb(240, 239, 239);
    cursor: pointer;
  }

  figcaption {
    text-align: center;
    font-size: .8rem;
    opacity: .15;
  }

  #next-jam-theme {
    width: fit-content;
    border: 1px solid black;
    margin-inline: auto;
    padding: .5rem 1rem;
    border-radius: 2rem;
    margin-block: 1rem;
  }
</style>
